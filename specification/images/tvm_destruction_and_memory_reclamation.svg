<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1180" height="884"><desc>title%20TVM%20destruction%20and%20memory%20reclaimation%0Aparticipant%20TVM%0A%0ATVM-%3ETSM%3A%20Exit%20from%20TVM-execution%20loop%0ATSM-%3ETSM%3A%20Examine%20fault%20and%20update%20VCPU%20shared-memory%20state%0ATSM-%3EHost%3A%20Notify%20host%20about%20TVM%20exit%0Anote%20over%20Host%3A%20Host%20determines%20that%20the%20TVM%20should%20be%20destroyed%0AHost-%3ETSM%3A%20Destroy%20TVM%0Adestroy%20TVM%0ATSM-%3ETSM%3A%20Update%20TVM%20state%0ATSM-%3ETSM%3A%20Return%20TVM%20confidential%20memory%20to%20internal%20pool%0Anote%20over%20Host%3A%20The%20host%20can%20reuse%20the%20freed%20confidential%20memory%20to%20create%20another%20TVM%0ATSM-%3EHost%3A%20Return%20to%20host%0Aalt%20Memory%20reclamation%20for%20non-confidential%20usage%0Anote%20over%20Host%3A%20The%20host%20needs%20to%20be%20explictitly%20reclaim%20confidential%20memory%20for%20non-confidential%20use%0AHost-%3ETSM%3A%20Reclaim%20confidential%20memory%0ATSM-%3ETSM%3A%20Scrub%20confidential%20memory%20and%20convert%20to%20non-confidential%20memory%0ATSM-%3EHost%3A%20Return%20to%20host%0Aend%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1180" height="884"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="16.5pt" font-style="normal" font-weight="normal" text-decoration="normal" x="354.98526398034073" y="22.6179738" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">TVM destruction and memory reclaimation</text></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 39.727436844548826 88.511670804 L 39.727436844548826 341.83297736400004" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 295.6482733912285 88.511670804 L 295.6482733912285 884.664348564" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 823.8368971849785 88.511670804 L 823.8368971849785 884.664348564" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 7.5393246000000005 47.799317964000004 L 71.91554908909765 47.799317964000004 L 71.91554908909765 88.511670804 L 7.5393246000000005 88.511670804 L 7.5393246000000005 47.799317964000004 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="23.899658982" y="73.43302160400002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">TVM</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 263.8212727876098 47.799317964000004 L 327.4752739948471 47.799317964000004 L 327.4752739948471 88.511670804 L 263.8212727876098 88.511670804 L 263.8212727876098 47.799317964000004 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="280.18160716960983" y="73.43302160400002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">TSM</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 790.7710078408203 47.799317964000004 L 856.9027865291367 47.799317964000004 L 856.9027865291367 88.511670804 L 790.7710078408203 88.511670804 L 790.7710078408203 47.799317964000004 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="807.1313422228203" y="73.43302160400002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Host</text></g></g><g><g><g><rect fill="white" stroke="none" x="57.57050506454882" y="118.668969204" width="220.2347001066797" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="59.832302444548816" y="132.239753484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Exit from TVM-execution loop</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 39.727436844548826 138.27121316400002 L 283.2335188832285 138.27121316400002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(295.6482733912285,138.27121316400002) translate(-295.6482733912285,-138.27121316400002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 283.0827323912285 131.98844266400002 L 295.6482733912285 138.27121316400002 L 283.0827323912285 144.55398366400001 Z"/></g></g><g><g><rect fill="white" stroke="none" x="313.49134161122845" y="160.88918696400003" width="402.30136575609373" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="315.75313899122847" y="174.45997124400003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Examine fault and update VCPU shared-memory state</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 295.6482733912285 180.491430924 L 355.9628701912285 180.491430924 L 355.9628701912285 200.09367488400002 L 308.0630278992285 200.09367488400002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(295.6482733912285,200.09367488400002) translate(-295.6482733912285,-200.09367488400002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 308.2138143912285 193.81090438400003 L 295.6482733912285 200.09367488400002 L 308.2138143912285 206.37644538400002 Z"/></g></g><g><g><rect fill="white" stroke="none" x="459.9863421073223" y="222.711648684" width="199.5124863615625" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="462.2481394873223" y="236.282432964" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Notify host about TVM exit</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 295.6482733912285 242.31389264400002 L 811.4221426769785 242.31389264400002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(823.8368971849785,242.31389264400002) translate(-823.8368971849785,-242.31389264400002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 811.2713561849785 236.03112214400002 L 823.8368971849785 242.31389264400002 L 811.2713561849785 248.59666314400002 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 615.1212280022442 264.93186644400004 L 1018.9817820877129 264.93186644400004 L 1032.5525663677129 278.50265072400003 L 1032.5525663677129 299.612759604 L 615.1212280022442 299.612759604 L 615.1212280022442 264.93186644400004 M 1018.9817820877129 264.93186644400004 L 1018.9817820877129 278.50265072400003 L 1032.5525663677129 278.50265072400003" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="636.2313368822441" y="286.0419753240001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Host determines that the TVM should be destroyed</text></g><g><g><rect fill="white" stroke="none" x="510.77523294594533" y="322.23073340400003" width="97.9347046843164" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="513.0370303259454" y="335.80151768400003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Destroy TVM</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 823.8368971849785 341.83297736400004 L 308.0630278992285 341.83297736400004" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(295.6482733912285,341.83297736400004) translate(-295.6482733912285,-341.83297736400004)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 308.2138143912285 335.550206864 L 295.6482733912285 341.83297736400004 L 308.2138143912285 348.11574786400007 Z"/></g></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 26.156652564548825 328.26219308400005 L 53.29822112454883 355.40376164400004 M 53.29822112454883 328.26219308400005 L 26.156652564548825 355.40376164400004" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g><rect fill="white" stroke="none" x="313.49134161122845" y="364.450951164" width="135.80136575609376" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="315.75313899122847" y="378.021735444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Update TVM state</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 295.6482733912285 384.053195124 L 355.9628701912285 384.053195124 L 355.9628701912285 403.655439084 L 308.0630278992285 403.655439084" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(295.6482733912285,403.655439084) translate(-295.6482733912285,-403.655439084)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 308.2138143912285 397.372668584 L 295.6482733912285 403.655439084 L 308.2138143912285 409.93820958400005 Z"/></g></g><g><g><rect fill="white" stroke="none" x="313.49134161122845" y="426.273412884" width="362.6569260588281" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="315.75313899122847" y="439.844197164" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Return TVM confidential memory to internal pool</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 295.6482733912285 445.875656844 L 355.9628701912285 445.875656844 L 355.9628701912285 465.477900804 L 308.0630278992285 465.477900804" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(295.6482733912285,465.477900804) translate(-295.6482733912285,-465.477900804)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 308.2138143912285 459.195130304 L 295.6482733912285 465.477900804 L 308.2138143912285 471.760671304 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 534.0212218987285 488.0958746040001 L 1100.0817881912285 488.0958746040001 L 1113.6525724712285 501.66665888400007 L 1113.6525724712285 522.776767764 L 534.0212218987285 522.776767764 L 534.0212218987285 488.0958746040001 M 1100.0817881912285 488.0958746040001 L 1100.0817881912285 501.66665888400007 L 1113.6525724712285 501.66665888400007" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="555.1313307787285" y="509.20598348400006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The host can reuse the freed confidential memory to create another TVM</text></g><g><g><rect fill="white" stroke="none" x="505.26412073281057" y="545.394741564" width="108.95692911058593" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.5259181128106" y="558.965525844" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Return to host</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 295.6482733912285 564.996985524 L 811.4221426769785 564.996985524" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(823.8368971849785,564.996985524) translate(-823.8368971849785,-564.996985524)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 811.2713561849785 558.714215024 L 823.8368971849785 564.996985524 L 811.2713561849785 571.279756024 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 489.8434570061504 628.3273121640001 L 1144.2595530838066 628.3273121640001 L 1157.8303373638066 641.8980964440001 L 1157.8303373638066 663.0082053240001 L 489.8434570061504 663.0082053240001 L 489.8434570061504 628.3273121640001 M 1144.2595530838066 628.3273121640001 L 1144.2595530838066 641.8980964440001 L 1157.8303373638066 641.8980964440001" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="510.9535658861504" y="649.4374210440001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The host needs to be explictitly reclaim confidential memory for non-confidential use</text></g><g><g><rect fill="white" stroke="none" x="450.08078638222463" y="685.626179124" width="219.32359781175782" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="452.34258376222465" y="699.196963404" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Reclaim confidential memory</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 823.8368971849785 705.228423084 L 308.0630278992285 705.228423084" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(295.6482733912285,705.228423084) translate(-295.6482733912285,-705.228423084)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 308.2138143912285 698.9456525840001 L 295.6482733912285 705.228423084 L 308.2138143912285 711.511193584 Z"/></g></g><g><g><rect fill="white" stroke="none" x="313.49134161122845" y="727.846396884" width="505.06802835375" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="315.75313899122847" y="741.417181164" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Scrub confidential memory and convert to non-confidential memory</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 295.6482733912285 747.448640844 L 355.9628701912285 747.448640844 L 355.9628701912285 767.050884804 L 308.0630278992285 767.050884804" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(295.6482733912285,767.050884804) translate(-295.6482733912285,-767.050884804)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 308.2138143912285 760.768114304 L 295.6482733912285 767.050884804 L 308.2138143912285 773.333655304 Z"/></g></g><g><g><rect fill="white" stroke="none" x="505.26412073281057" y="789.668858604" width="108.95692911058593" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.5259181128106" y="803.239642884" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Return to host</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 295.6482733912285 809.271102564 L 811.4221426769785 809.271102564" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(823.8368971849785,809.271102564) translate(-823.8368971849785,-809.271102564)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 811.2713561849785 802.988332064 L 823.8368971849785 809.271102564 L 811.2713561849785 815.553873064 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 242.87300119122847 587.614959324 L 1165.3696619638067 587.614959324 L 1165.3696619638067 831.889076364 L 242.87300119122847 831.889076364 L 242.87300119122847 587.614959324 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 242.87300119122847 587.614959324 L 242.87300119122847 605.709338364 L 290.5858549348564 605.709338364 L 299.6330444548564 596.662148844 L 299.6330444548564 587.614959324 L 242.87300119122847 587.614959324" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="257.95165039122844" y="599.677878684" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><g><rect fill="white" stroke="none" x="312.44989627485637" y="588.82125126" width="330.40137185960936" height="15.681795168000004"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="314.7116936548564" y="599.677878684" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Memory reclamation for non-confidential usage]</text></g></g><g/><g/><g/></g></svg>